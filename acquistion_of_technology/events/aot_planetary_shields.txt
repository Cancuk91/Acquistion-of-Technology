namespace = aot_planetary_shields_event
#---------------------------------------
# This handles the creation of shield
# ambient objects on planets.
#---------------------------------------
# Dark Matter shield generator completed.
# This = Planet
planet_event = {
	id = aot_planetary_shields_event.1
	hide_window = yes
	is_triggered_only = yes
	trigger = {
		NOT = {
			has_global_flag = dm_planetary_shields_OFF
		}
		is_ringworld = no
		NOR = {
			is_planet_class = pc_habitat
		}
		has_building = building_dark_energy_psg
	}
	immediate = {
		planet_event = {
			id = aot_planetary_shields_event.3
		}
	}
}

# Dark Energy shield generator completed.
# This = Planet
planet_event = {
	id = aot_planetary_shields_event.2
	hide_window = yes
	is_triggered_only = yes
	trigger = {
		NOT = {
			has_global_flag = dm_planetary_shields_OFF
		}
		is_ringworld = no
		NOR = {
			is_planet_class = pc_habitat
		}
		has_building = building_ae_dark_energy_psg
	}
	immediate = {
		planet_event = {
			id = aot_planetary_shields_event.4
		}
	}
}

# Creation of dark energy shields for planets.
# This = Planet
planet_event = {
	id = aot_planetary_shields_event.3
	hide_window = yes
	is_triggered_only = yes
	trigger = {
		NOT = {
			has_global_flag = dm_planetary_shields_OFF
		}
	}
	immediate = {
		remove_planet_flag = has_dm_planetary_shield_01
		solar_system = {
			every_system_ambient_object = {
				limit = {
					has_ambient_object_flag = dm_planetary_shield_01
				}
				destroy_ambient_object = this
			}
			every_system_planet = {
				limit = {
					is_ringworld = no
					NOT = {
						is_planet_class = pc_habitat
					}
					has_building = building_dark_energy_psg
				}
				solar_system = {
					random_system_planet = {
						limit = {
							is_moon = no
						}
						IF = {
							limit = {
								prevprev = {
									is_moon = no
									planet_size = 25
								}
							}
							create_ambient_object = {
								type = dm_planetary_shield_ps_25
								location = this
							}
						}
						IF = {
							limit = {
								prevprev = {
									is_moon = no
									planet_size = 24
								}
							}
							create_ambient_object = {
								type = dm_planetary_shield_ps_24
								location = this
							}
						}
						IF = {
							limit = {
								prevprev = {
									is_moon = no
									planet_size = 23
								}
							}
							create_ambient_object = {
								type = dm_planetary_shield_ps_23
								location = this
							}
						}
						IF = {
							limit = {
								prevprev = {
									is_moon = no
									planet_size = 22
								}
							}
							create_ambient_object = {
								type = dm_planetary_shield_ps_22
								location = this
							}
						}
						IF = {
							limit = {
								prevprev = {
									is_moon = no
									planet_size = 21
								}
							}
							create_ambient_object = {
								type = dm_planetary_shield_ps_21
								location = this
							}
						}
						IF = {
							limit = {
								prevprev = {
									is_moon = no
									planet_size = 20
								}
							}
							create_ambient_object = {
								type = dm_planetary_shield_ps_20
								location = this
							}
						}
						IF = {
							limit = {
								prevprev = {
									is_moon = no
									planet_size = 19
								}
							}
							create_ambient_object = {
								type = dm_planetary_shield_ps_19
								location = this
							}
						}
						IF = {
							limit = {
								prevprev = {
									is_moon = no
									planet_size = 18
								}
							}
							create_ambient_object = {
								type = dm_planetary_shield_ps_18
								location = this
							}
						}
						IF = {
							limit = {
								prevprev = {
									is_moon = no
									planet_size = 17
								}
							}
							create_ambient_object = {
								type = dm_planetary_shield_ps_17
								location = this
							}
						}
						IF = {
							limit = {
								prevprev = {
									is_moon = no
									planet_size = 16
								}
							}
							create_ambient_object = {
								type = dm_planetary_shield_ps_16
								location = this
							}
						}
						IF = {
							limit = {
								prevprev = {
									is_moon = no
									planet_size = 15
								}
							}
							create_ambient_object = {
								type = dm_planetary_shield_ps_15
								location = this
							}
						}
						IF = {
							limit = {
								prevprev = {
									is_moon = no
									planet_size = 14
								}
							}
							create_ambient_object = {
								type = dm_planetary_shield_ps_14
								location = this
							}
						}
						IF = {
							limit = {
								prevprev = {
									is_moon = no
									planet_size = 13
								}
							}
							create_ambient_object = {
								type = dm_planetary_shield_ps_13
								location = this
							}
						}
						IF = {
							limit = {
								prevprev = {
									is_moon = no
									planet_size = 12
								}
							}
							create_ambient_object = {
								type = dm_planetary_shield_ps_12
								location = this
							}
						}
						IF = {
							limit = {
								prevprev = {
									is_moon = no
									planet_size = 11
								}
							}
							create_ambient_object = {
								type = dm_planetary_shield_ps_11
								location = this
							}
						}
						IF = {
							limit = {
								prevprev = {
									is_moon = no
									planet_size < 11
								}
							}
							create_ambient_object = {
								type = dm_planetary_shield_ps_10
								location = this
							}
						}
						IF = {
							limit = {
								prevprev = {
									is_moon = yes
									planet_size = 25
								}
							}
							create_ambient_object = {
								type = dm_planetary_shield_ps_17
								location = this
							}
						}
						IF = {
							limit = {
								prevprev = {
									is_moon = yes
									planet_size = 24
								}
							}
							create_ambient_object = {
								type = dm_planetary_shield_ps_17
								location = this
							}
						}
						IF = {
							limit = {
								prevprev = {
									is_moon = yes
									planet_size = 23
								}
							}
							create_ambient_object = {
								type = dm_planetary_shield_ps_16
								location = this
							}
						}
						IF = {
							limit = {
								prevprev = {
									is_moon = yes
									planet_size = 22
								}
							}
							create_ambient_object = {
								type = dm_planetary_shield_ps_16
								location = this
							}
						}
						IF = {
							limit = {
								prevprev = {
									is_moon = yes
									planet_size = 21
								}
							}
							create_ambient_object = {
								type = dm_planetary_shield_ps_15
								location = this
							}
						}
						IF = {
							limit = {
								prevprev = {
									is_moon = yes
									planet_size = 20
								}
							}
							create_ambient_object = {
								type = dm_planetary_shield_ps_14
								location = this
							}
						}
						IF = {
							limit = {
								prevprev = {
									is_moon = yes
									planet_size = 19
								}
							}
							create_ambient_object = {
								type = dm_planetary_shield_ps_13
								location = this
							}
						}
						IF = {
							limit = {
								prevprev = {
									is_moon = yes
									planet_size = 18
								}
							}
							create_ambient_object = {
								type = dm_planetary_shield_ps_12
								location = this
							}
						}
						IF = {
							limit = {
								prevprev = {
									is_moon = yes
									planet_size = 17
								}
							}
							create_ambient_object = {
								type = dm_planetary_shield_ps_12
								location = this
							}
						}
						IF = {
							limit = {
								prevprev = {
									is_moon = yes
									planet_size = 16
								}
							}
							create_ambient_object = {
								type = dm_planetary_shield_ps_11
								location = this
							}
						}
						IF = {
							limit = {
								prevprev = {
									is_moon = yes
									planet_size = 15
								}
							}
							create_ambient_object = {
								type = dm_planetary_shield_ps_10
								location = this
							}
						}
						IF = {
							limit = {
								prevprev = {
									is_moon = yes
									planet_size = 14
								}
							}
							create_ambient_object = {
								type = dm_planetary_shield_ps_09
								location = this
							}
						}
						IF = {
							limit = {
								prevprev = {
									is_moon = yes
									planet_size = 13
								}
							}
							create_ambient_object = {
								type = dm_planetary_shield_ps_09
								location = this
							}
						}
						IF = {
							limit = {
								prevprev = {
									is_moon = yes
									planet_size = 12
								}
							}
							create_ambient_object = {
								type = dm_planetary_shield_ps_08
								location = this
							}
						}
						IF = {
							limit = {
								prevprev = {
									is_moon = yes
									planet_size = 11
								}
							}
							create_ambient_object = {
								type = dm_planetary_shield_ps_08
								location = this
							}
						}
						IF = {
							limit = {
								prevprev = {
									is_moon = yes
									planet_size < 11
								}
							}
							create_ambient_object = {
								type = dm_planetary_shield_ps_07
								location = this
							}
						}
					}
					last_created_ambient_object = {
						set_location = prevprev
						set_ambient_object_flag = dm_planetary_shield_01
					}
				}
				set_planet_flag = has_dm_planetary_shield_01
			}
		}
	}
}

# Creation of dark energy shields for planets.
# This = Planet
planet_event = {
	id = aot_planetary_shields_event.4
	hide_window = yes
	is_triggered_only = yes
	trigger = {
		NOT = {
			has_global_flag = dm_planetary_shields_OFF
		}
	}
	immediate = {
		remove_planet_flag = has_ae_planetary_shield_01
		solar_system = {
			every_system_ambient_object = {
				limit = {
					has_ambient_object_flag = ae_planetary_shield_01
				}
				destroy_ambient_object = this
			}
			every_system_planet = {
				limit = {
					is_ringworld = no
					NOT = {
						is_planet_class = pc_habitat
					}
					has_building = building_ae_dark_energy_psg
				}
				solar_system = {
					random_system_planet = {
						limit = {
							is_moon = no
						}
						IF = {
							limit = {
								prevprev = {
									is_moon = no
									planet_size = 25
								}
							}
							create_ambient_object = {
								type = ae_planetary_shield_ps_25
								location = this
							}
						}
						IF = {
							limit = {
								prevprev = {
									is_moon = no
									planet_size = 24
								}
							}
							create_ambient_object = {
								type = ae_planetary_shield_ps_24
								location = this
							}
						}
						IF = {
							limit = {
								prevprev = {
									is_moon = no
									planet_size = 23
								}
							}
							create_ambient_object = {
								type = ae_planetary_shield_ps_23
								location = this
							}
						}
						IF = {
							limit = {
								prevprev = {
									is_moon = no
									planet_size = 22
								}
							}
							create_ambient_object = {
								type = ae_planetary_shield_ps_22
								location = this
							}
						}
						IF = {
							limit = {
								prevprev = {
									is_moon = no
									planet_size = 21
								}
							}
							create_ambient_object = {
								type = ae_planetary_shield_ps_21
								location = this
							}
						}
						IF = {
							limit = {
								prevprev = {
									is_moon = no
									planet_size = 20
								}
							}
							create_ambient_object = {
								type = ae_planetary_shield_ps_20
								location = this
							}
						}
						IF = {
							limit = {
								prevprev = {
									is_moon = no
									planet_size = 19
								}
							}
							create_ambient_object = {
								type = ae_planetary_shield_ps_19
								location = this
							}
						}
						IF = {
							limit = {
								prevprev = {
									is_moon = no
									planet_size = 18
								}
							}
							create_ambient_object = {
								type = ae_planetary_shield_ps_18
								location = this
							}
						}
						IF = {
							limit = {
								prevprev = {
									is_moon = no
									planet_size = 17
								}
							}
							create_ambient_object = {
								type = ae_planetary_shield_ps_17
								location = this
							}
						}
						IF = {
							limit = {
								prevprev = {
									is_moon = no
									planet_size = 16
								}
							}
							create_ambient_object = {
								type = ae_planetary_shield_ps_16
								location = this
							}
						}
						IF = {
							limit = {
								prevprev = {
									is_moon = no
									planet_size = 15
								}
							}
							create_ambient_object = {
								type = ae_planetary_shield_ps_15
								location = this
							}
						}
						IF = {
							limit = {
								prevprev = {
									is_moon = no
									planet_size = 14
								}
							}
							create_ambient_object = {
								type = ae_planetary_shield_ps_14
								location = this
							}
						}
						IF = {
							limit = {
								prevprev = {
									is_moon = no
									planet_size = 13
								}
							}
							create_ambient_object = {
								type = ae_planetary_shield_ps_13
								location = this
							}
						}
						IF = {
							limit = {
								prevprev = {
									is_moon = no
									planet_size = 12
								}
							}
							create_ambient_object = {
								type = ae_planetary_shield_ps_12
								location = this
							}
						}
						IF = {
							limit = {
								prevprev = {
									is_moon = no
									planet_size = 11
								}
							}
							create_ambient_object = {
								type = ae_planetary_shield_ps_11
								location = this
							}
						}
						IF = {
							limit = {
								prevprev = {
									is_moon = no
									planet_size < 11
								}
							}
							create_ambient_object = {
								type = ae_planetary_shield_ps_10
								location = this
							}
						}
						IF = {
							limit = {
								prevprev = {
									is_moon = yes
									planet_size = 25
								}
							}
							create_ambient_object = {
								type = ae_planetary_shield_ps_17
								location = this
							}
						}
						IF = {
							limit = {
								prevprev = {
									is_moon = yes
									planet_size = 24
								}
							}
							create_ambient_object = {
								type = ae_planetary_shield_ps_17
								location = this
							}
						}
						IF = {
							limit = {
								prevprev = {
									is_moon = yes
									planet_size = 23
								}
							}
							create_ambient_object = {
								type = ae_planetary_shield_ps_16
								location = this
							}
						}
						IF = {
							limit = {
								prevprev = {
									is_moon = yes
									planet_size = 22
								}
							}
							create_ambient_object = {
								type = ae_planetary_shield_ps_16
								location = this
							}
						}
						IF = {
							limit = {
								prevprev = {
									is_moon = yes
									planet_size = 21
								}
							}
							create_ambient_object = {
								type = ae_planetary_shield_ps_15
								location = this
							}
						}
						IF = {
							limit = {
								prevprev = {
									is_moon = yes
									planet_size = 20
								}
							}
							create_ambient_object = {
								type = ae_planetary_shield_ps_14
								location = this
							}
						}
						IF = {
							limit = {
								prevprev = {
									is_moon = yes
									planet_size = 19
								}
							}
							create_ambient_object = {
								type = ae_planetary_shield_ps_13
								location = this
							}
						}
						IF = {
							limit = {
								prevprev = {
									is_moon = yes
									planet_size = 18
								}
							}
							create_ambient_object = {
								type = ae_planetary_shield_ps_12
								location = this
							}
						}
						IF = {
							limit = {
								prevprev = {
									is_moon = yes
									planet_size = 17
								}
							}
							create_ambient_object = {
								type = ae_planetary_shield_ps_12
								location = this
							}
						}
						IF = {
							limit = {
								prevprev = {
									is_moon = yes
									planet_size = 16
								}
							}
							create_ambient_object = {
								type = ae_planetary_shield_ps_11
								location = this
							}
						}
						IF = {
							limit = {
								prevprev = {
									is_moon = yes
									planet_size = 15
								}
							}
							create_ambient_object = {
								type = ae_planetary_shield_ps_10
								location = this
							}
						}
						IF = {
							limit = {
								prevprev = {
									is_moon = yes
									planet_size = 14
								}
							}
							create_ambient_object = {
								type = ae_planetary_shield_ps_09
								location = this
							}
						}
						IF = {
							limit = {
								prevprev = {
									is_moon = yes
									planet_size = 13
								}
							}
							create_ambient_object = {
								type = ae_planetary_shield_ps_09
								location = this
							}
						}
						IF = {
							limit = {
								prevprev = {
									is_moon = yes
									planet_size = 12
								}
							}
							create_ambient_object = {
								type = ae_planetary_shield_ps_08
								location = this
							}
						}
						IF = {
							limit = {
								prevprev = {
									is_moon = yes
									planet_size = 11
								}
							}
							create_ambient_object = {
								type = ae_planetary_shield_ps_08
								location = this
							}
						}
						IF = {
							limit = {
								prevprev = {
									is_moon = yes
									planet_size < 11
								}
							}
							create_ambient_object = {
								type = ae_planetary_shield_ps_07
								location = this
							}
						}
					}
					last_created_ambient_object = {
						set_location = prevprev
						set_ambient_object_flag = ae_planetary_shield_01
					}
				}
				set_planet_flag = has_ae_planetary_shield_01
			}
		}
	}
}

# Cleanup leftover shields at the end of the month
# This = Planet
country_event = {
	id = aot_planetary_shields_event.5
	hide_window = yes
	is_triggered_only = yes
	trigger = {
		NOT = {
			has_global_flag = dm_planetary_shields_OFF
		}
	}
	immediate = {
		every_owned_planet = {
			limit = {
				OR = {
					NOR = {
						has_building = building_dark_energy_psg
						has_building = building_ae_dark_energy_psg
					}
					AND = {
						has_building = building_dark_energy_psg
						NOT = {
							has_planet_flag = has_dm_planetary_shield_01
						}
					}
					AND = {
						has_building = building_ae_dark_energy_psg
						NOT = {
							has_planet_flag = has_ae_planetary_shield_01
						}
					}
				}
			}
			planet_event = {
				id = aot_planetary_shields_event.3
			}
			planet_event = {
				id = aot_planetary_shields_event.4
			}
		}
	}
}

# Delete all planetary shields via ACOT edict decision.
# This = Planet
country_event = {
	id = aot_planetary_shields_event.6
	hide_window = yes
	is_triggered_only = yes
	immediate = {
		every_owned_planet = {
			remove_planet_flag = has_ae_planetary_shield_01
			remove_planet_flag = has_dm_planetary_shield_01
			solar_system = {
				every_system_ambient_object = {
					limit = {
						OR = {
							has_ambient_object_flag = ae_planetary_shield_01
							has_ambient_object_flag = dm_planetary_shield_01
						}
					}
					destroy_ambient_object = this
				}
			}
		}
	}
}
