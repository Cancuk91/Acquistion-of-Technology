@inner_mega_cannon_distance = 208
@outer_mega_cannon_distance = 438
@void_sphere_distance = 245
@void_sphere_planet_size = 25
#######################
# PHANON PROTECC STUFFS
#######################
create_protecc_country = {
	create_species = {
		name = "Phanon GLA Workers"
		class = HUM
		portrait = human
		traits = random
		extra_trait_points = 6
		allow_negative_traits = no
		effect = {
			save_global_event_target_as = phanon_species
		}
	}
	create_species = {
		name = "Phanon Operatives"
		class = PHANON
		portrait = acot_pmc
		traits = random
		extra_trait_points = 10
		allow_negative_traits = no
		effect = {
			save_global_event_target_as = phanon_operative_species
		}
	}
	create_country = {
		name = "Phanon P.R.O.T.E.C.C."
		name_list = Phanon
		species = event_target:phanon_operative_species
		type = acot_phanon_retaliator
		civics = {
			civic = civic_acot_phanon_fleet
			civic = civic_acot_phanon_corps
		}
		origin = "origin_default"
		flag = {
			background = {
				category = "backgrounds"
				file = "v.dds"
			}
			icon = {
				category = phanon
				file = flag_phanon.dds
			}
			colors = {
				"red"
				"black"
				"null"
				"null"
			}
		}
		ethos = {
			ethic = ethic_fanatic_authoritarian
			ethic = ethic_militarist
		}
		ignore_initial_colony_error = yes
	}
	last_created_country = {
		set_graphical_culture = acot_pmc
		save_global_event_target_as = phanon_protecc_base_country
		set_country_flag = phanon_protecc_base_country
		create_ship_design = {
			design = "NAME_ACOT_STAR_COMMANDER"
		}
		add_ship_design = last_created_design
		create_ship_design = {
			design = "NAME_ACOT_STARBENDER"
		}
		add_ship_design = last_created_design
		### ESTABLISHU CONTACTSU
		establish_communications = root
		every_country = {
			limit = {
				OR = {
					is_country_type = enclave
					is_country_type = dormant_marauders
					is_fallen_empire = yes
					is_fallen_machine_empire = yes
					has_origin = origin_playable_oe_singular
					has_origin = origin_playable_oe
				}
			}
			establish_communications_no_message = event_target:phanon_protecc_base_country
		}
	}
	#Make Protecc bois mad against everybody.
	every_country = {
		limit = {
			NOR = {
				is_country_type = enclave
				is_country_type = dormant_marauders
				is_country_type = acot_phanon_base
				is_country_type = acot_phanon_retaliator
				is_country_type = acot_hero_ship_phanon
				is_fallen_empire = yes
				is_fallen_machine_empire = yes
				has_origin = origin_playable_oe_singular
				has_origin = origin_playable_oe
			}
		}
		set_faction_hostility = {
			target = event_target:phanon_protecc_base_country
			set_hostile = yes
			set_neutral = no
			set_friendly = no
		}
	}
}

create_phanon_protecc_wave_1 = {
	owner = {
		create_leader = {
			class = admiral
			species = event_target:phanon_operative_species
			name = "Phanon Operative Type A"
			skill = 10
			immortal = yes
			leader_age_min = 1000
			leader_age_max = 100000
			traits = {
				trait = leader_trait_acot_phanon_admiral
				trait = leader_trait_admiral_cyborg
				trait = leader_trait_admiral_psionic
				trait = leader_trait_admiral_erudite
			}
			event_leader = yes			# prevents this leader from leading factions and winning elections
			effect = {
				random_list = {
					5 = {
						set_name = "A11-C"
					}
					5 = {
						set_name = "A35-C"
					}
					5 = {
						set_name = "A24-A"
					}
					5 = {
						set_name = "A07-B"
					}
					5 = {
						set_name = "A65-A"
					}
					5 = {
						set_name = "A28-B"
					}
					5 = {
						set_name = "A41-B"
					}
					5 = {
						set_name = "A17-A"
					}
					5 = {
						set_name = "A62-A"
					}
					5 = {
						set_name = "A67-C"
					}
					5 = {
						set_name = "A42-B"
					}
					5 = {
						set_name = "A91-B"
					}
					5 = {
						set_name = "A85-C"
					}
					5 = {
						set_name = "A53-C"
					}
					5 = {
						set_name = "A10-B"
					}
					5 = {
						set_name = "A17-A"
					}
				}
			}
		}
	}
	create_fleet = {
		effect = {
			set_owner = event_target:phanon_protecc_base_country
			while = {
				count = 20
				create_ship = {
					name = random
					design = "NAME_ACOT_DESTROYER"
					graphical_culture = "acot_pmc"
				}
			}
			assign_leader = last_created_leader
			while = {
				count = 30
				create_ship = {
					name = random
					design = "NAME_ACOT_STARFIGHTERS"
					graphical_culture = "acot_pmc"
				}
			}
			set_formation_scale = 2
			set_fleet_stance = aggressive
			set_aggro_range_measure_from = self
			set_aggro_range = 275
			set_location = {
				target = prev
				distance = 25
				angle = 15
			}
		}
		settings = {
			is_boss = no
			garrison = yes
		}
	}
}

create_phanon_protecc_wave_2 = {
	owner = {
		create_leader = {
			class = admiral
			species = event_target:phanon_operative_species
			name = "Phanon Operative Type A"
			skill = 10
			immortal = yes
			leader_age_min = 1000
			leader_age_max = 100000
			traits = {
				trait = leader_trait_acot_phanon_admiral
				trait = leader_trait_admiral_cyborg
				trait = leader_trait_admiral_psionic
				trait = leader_trait_admiral_erudite
			}
			event_leader = yes			# prevents this leader from leading factions and winning elections
			effect = {
				random_list = {
					5 = {
						set_name = "A11-C"
					}
					5 = {
						set_name = "A35-C"
					}
					5 = {
						set_name = "A24-A"
					}
					5 = {
						set_name = "A07-B"
					}
					5 = {
						set_name = "A65-A"
					}
					5 = {
						set_name = "A28-B"
					}
					5 = {
						set_name = "A41-B"
					}
					5 = {
						set_name = "A17-A"
					}
					5 = {
						set_name = "A62-A"
					}
					5 = {
						set_name = "A67-C"
					}
					5 = {
						set_name = "A42-B"
					}
					5 = {
						set_name = "A91-B"
					}
					5 = {
						set_name = "A85-C"
					}
					5 = {
						set_name = "A53-C"
					}
					5 = {
						set_name = "A10-B"
					}
					5 = {
						set_name = "A17-A"
					}
				}
			}
		}
	}
	create_fleet = {
		effect = {
			set_owner = event_target:phanon_protecc_base_country
			while = {
				count = 2
				create_ship = {
					name = random
					design = "NAME_ACOT_DEVASTATOR"
					graphical_culture = "acot_pmc"
				}
			}
			assign_leader = last_created_leader
			while = {
				count = 15
				create_ship = {
					name = random
					design = "NAME_ACOT_DESTROYER"
					graphical_culture = "acot_pmc"
				}
			}
			while = {
				count = 20
				create_ship = {
					name = random
					design = "NAME_ACOT_STARFIGHTERS"
					graphical_culture = "acot_pmc"
				}
			}
			set_formation_scale = 2
			set_fleet_stance = aggressive
			set_aggro_range_measure_from = self
			set_aggro_range = 275
			set_location = {
				target = prev
				distance = 25
				angle = 15
			}
		}
		settings = {
			is_boss = no
			garrison = yes
		}
	}
}

create_phanon_protecc_wave_3 = {
	owner = {
		create_leader = {
			class = admiral
			species = event_target:phanon_operative_species
			name = "Phanon Operative Type A"
			skill = 10
			immortal = yes
			leader_age_min = 1000
			leader_age_max = 100000
			traits = {
				trait = leader_trait_acot_phanon_admiral
				trait = leader_trait_admiral_cyborg
				trait = leader_trait_admiral_psionic
				trait = leader_trait_admiral_erudite
			}
			event_leader = yes			# prevents this leader from leading factions and winning elections
			effect = {
				random_list = {
					5 = {
						set_name = "A11-C"
					}
					5 = {
						set_name = "A35-C"
					}
					5 = {
						set_name = "A24-A"
					}
					5 = {
						set_name = "A07-B"
					}
					5 = {
						set_name = "A65-A"
					}
					5 = {
						set_name = "A28-B"
					}
					5 = {
						set_name = "A41-B"
					}
					5 = {
						set_name = "A17-A"
					}
					5 = {
						set_name = "A62-A"
					}
					5 = {
						set_name = "A67-C"
					}
					5 = {
						set_name = "A42-B"
					}
					5 = {
						set_name = "A91-B"
					}
					5 = {
						set_name = "A85-C"
					}
					5 = {
						set_name = "A53-C"
					}
					5 = {
						set_name = "A10-B"
					}
					5 = {
						set_name = "A17-A"
					}
				}
			}
		}
	}
	create_fleet = {
		effect = {
			set_owner = event_target:phanon_protecc_base_country
			create_ship = {
				name = random
				design = "NAME_ACOT_ANNIHILATOR"
				graphical_culture = "acot_pmc"
			}
			assign_leader = last_created_leader
			while = {
				count = 8
				create_ship = {
					name = random
					design = "NAME_ACOT_DEVASTATOR"
					graphical_culture = "acot_pmc"
				}
			}
			while = {
				count = 12
				create_ship = {
					name = random
					design = "NAME_ACOT_DESTROYER"
					graphical_culture = "acot_pmc"
				}
			}
			while = {
				count = 15
				create_ship = {
					name = random
					design = "NAME_ACOT_STARFIGHTERS"
					graphical_culture = "acot_pmc"
				}
			}
			set_formation_scale = 2
			set_fleet_stance = aggressive
			set_aggro_range_measure_from = self
			set_aggro_range = 275
			set_location = {
				target = prev
				distance = 25
				angle = 15
			}
		}
		settings = {
			is_boss = no
			garrison = yes
		}
	}
}

create_phanon_protecc_wave_4 = {
	owner = {
		create_leader = {
			class = admiral
			species = event_target:phanon_operative_species
			name = "Phanon Operative Type A"
			skill = 10
			immortal = yes
			leader_age_min = 1000
			leader_age_max = 100000
			traits = {
				trait = leader_trait_acot_phanon_admiral
				trait = leader_trait_admiral_cyborg
				trait = leader_trait_admiral_psionic
				trait = leader_trait_admiral_erudite
			}
			event_leader = yes			# prevents this leader from leading factions and winning elections
			effect = {
				random_list = {
					5 = {
						set_name = "A11-C"
					}
					5 = {
						set_name = "A35-C"
					}
					5 = {
						set_name = "A24-A"
					}
					5 = {
						set_name = "A07-B"
					}
					5 = {
						set_name = "A65-A"
					}
					5 = {
						set_name = "A28-B"
					}
					5 = {
						set_name = "A41-B"
					}
					5 = {
						set_name = "A17-A"
					}
					5 = {
						set_name = "A62-A"
					}
					5 = {
						set_name = "A67-C"
					}
					5 = {
						set_name = "A42-B"
					}
					5 = {
						set_name = "A91-B"
					}
					5 = {
						set_name = "A85-C"
					}
					5 = {
						set_name = "A53-C"
					}
					5 = {
						set_name = "A10-B"
					}
					5 = {
						set_name = "A17-A"
					}
				}
			}
		}
	}
	create_fleet = {
		effect = {
			set_owner = event_target:phanon_protecc_base_country
			create_ship = {
				name = random
				design = "NAME_ACOT_ANNIHILATOR"
				graphical_culture = "acot_pmc"
			}
			assign_leader = last_created_leader
			while = {
				count = 8
				create_ship = {
					name = random
					design = "NAME_ACOT_DEVASTATOR"
					graphical_culture = "acot_pmc"
				}
			}
			while = {
				count = 12
				create_ship = {
					name = random
					design = "NAME_ACOT_DESTROYER"
					graphical_culture = "acot_pmc"
				}
			}
			while = {
				count = 12
				create_ship = {
					name = random
					design = "NAME_ACOT_STARFIGHTERS"
					graphical_culture = "acot_pmc"
				}
			}
			set_formation_scale = 2
			set_fleet_stance = aggressive
			set_aggro_range_measure_from = self
			set_aggro_range = 275
			set_location = {
				target = prev
				distance = 25
				angle = 15
			}
		}
		settings = {
			is_boss = no
			garrison = yes
		}
	}
}

#Move the spawned fleet to system sun if spawned too far outside.
move_protecc_fleet_to_system_star = {
	solar_system = {
		system_star = {
			save_event_target_as = this_system_star
		}
		every_fleet_in_system = {
			limit = {
				is_owned_by = event_target:phanon_protecc_base_country
			}
			auto_move_to_planet = {
				target = event_target:this_system_star
				clear_auto_move_on_arrival = yes
			}
		}
	}
}

# Phanon Pylon blasts system to bits
destroy_solar_system = {
	solar_system = {
		set_star_class = sc_phanon_pylon
	}
	every_system_planet = {
		limit = {
			is_star = yes
		}
		save_event_target_as = last_created_phanon_pylon
		create_ambient_object = {
			type = "star_explosion"
			play_animation_once = yes
			location = this
		}
		last_created_ambient_object = {
			set_location = {
				target = prev
				distance = 0
				angle = random
			}
		}
		change_pc = pc_phanon_pylon_star
	}
	every_system_planet = {
		limit = {
			is_star = no
		}
		remove_planet = yes
	}
	set_asteroid_belt = {
		radius = 0
	}
	every_system_planet = {
		clear_deposits = yes
		clear_planet_modifiers = yes
		prevent_anomaly = yes
	}
	every_system_planet = {
		limit = {
			is_asteroid = yes
		}
		clear_deposits = yes
	}
	every_system_planet = {
		limit = {
			exists = orbital_station
		}
		orbital_station = {
			dismantle = yes
		}
	}
}

#######################
# PHANON INFRASTRUCTURE
#######################
spawn_inner_phanon_mega_turrets = {
	spawn_megastructure = {
		name = "Mega Turret 1"
		type = "phanon_megaturret_intermediate_1"
		orbit_angle = 0
		orbit_distance = @inner_mega_cannon_distance
		owner = from
		planet = star
	}
	spawn_megastructure = {
		name = "Mega Turret 2"
		type = "phanon_megaturret_intermediate_1"
		orbit_angle = 30
		orbit_distance = @inner_mega_cannon_distance
		owner = from
		planet = star
	}
	spawn_megastructure = {
		name = "Mega Turret 3"
		type = "phanon_megaturret_intermediate_1"
		orbit_angle = 60
		orbit_distance = @inner_mega_cannon_distance
		owner = from
		planet = star
	}
	spawn_megastructure = {
		name = "Mega Turret 4"
		type = "phanon_megaturret_intermediate_1"
		orbit_angle = 120
		orbit_distance = @inner_mega_cannon_distance
		owner = from
		planet = star
	}
	spawn_megastructure = {
		name = "Mega Turret 5"
		type = "phanon_megaturret_intermediate_1"
		orbit_angle = 150
		orbit_distance = @inner_mega_cannon_distance
		owner = from
		planet = star
	}
	spawn_megastructure = {
		name = "Mega Turret 6"
		type = "phanon_megaturret_intermediate_1"
		orbit_angle = 180
		orbit_distance = @inner_mega_cannon_distance
		owner = from
		planet = star
	}
	spawn_megastructure = {
		name = "Mega Turret 7"
		type = "phanon_megaturret_intermediate_1"
		orbit_angle = 240
		orbit_distance = @inner_mega_cannon_distance
		owner = from
		planet = star
	}
	spawn_megastructure = {
		name = "Mega Turret 8"
		type = "phanon_megaturret_intermediate_1"
		orbit_angle = 270
		orbit_distance = @inner_mega_cannon_distance
		owner = from
		planet = star
	}
	spawn_megastructure = {
		name = "Mega Turret 9"
		type = "phanon_megaturret_intermediate_1"
		orbit_angle = 300
		orbit_distance = @inner_mega_cannon_distance
		owner = from
		planet = star
	}
}

spawn_outer_phanon_mega_turrets = {
	spawn_megastructure = {
		name = "Mega Turret 1"
		type = "phanon_megaturret_intermediate_1"
		orbit_angle = 0
		orbit_distance = @outer_mega_cannon_distance
		owner = from
		planet = star
	}
	spawn_megastructure = {
		name = "Mega Turret 2"
		type = "phanon_megaturret_intermediate_1"
		orbit_angle = 15
		orbit_distance = @outer_mega_cannon_distance
		owner = from
		planet = star
	}
	spawn_megastructure = {
		name = "Mega Turret 3"
		type = "phanon_megaturret_intermediate_1"
		orbit_angle = 30
		orbit_distance = @outer_mega_cannon_distance
		owner = from
		planet = star
	}
	spawn_megastructure = {
		name = "Mega Turret 4"
		type = "phanon_megaturret_intermediate_1"
		orbit_angle = 45
		orbit_distance = @outer_mega_cannon_distance
		owner = from
		planet = star
	}
	spawn_megastructure = {
		name = "Mega Turret 5"
		type = "phanon_megaturret_intermediate_1"
		orbit_angle = 60
		orbit_distance = @outer_mega_cannon_distance
		owner = from
		planet = star
	}
	spawn_megastructure = {
		name = "Mega Turret 6"
		type = "phanon_megaturret_intermediate_1"
		orbit_angle = 75
		orbit_distance = @outer_mega_cannon_distance
		owner = from
		planet = star
	}
	spawn_megastructure = {
		name = "Mega Turret 7"
		type = "phanon_megaturret_intermediate_1"
		orbit_angle = 90
		orbit_distance = @outer_mega_cannon_distance
		owner = from
		planet = star
	}
	spawn_megastructure = {
		name = "Mega Turret 8"
		type = "phanon_megaturret_intermediate_1"
		orbit_angle = 105
		orbit_distance = @outer_mega_cannon_distance
		owner = from
		planet = star
	}
	spawn_megastructure = {
		name = "Mega Turret 9"
		type = "phanon_megaturret_intermediate_1"
		orbit_angle = 120
		orbit_distance = @outer_mega_cannon_distance
		owner = from
		planet = star
	}
	spawn_megastructure = {
		name = "Mega Turret 10"
		type = "phanon_megaturret_intermediate_1"
		orbit_angle = 135
		orbit_distance = @outer_mega_cannon_distance
		owner = from
		planet = star
	}
	spawn_megastructure = {
		name = "Mega Turret 11"
		type = "phanon_megaturret_intermediate_1"
		orbit_angle = 150
		orbit_distance = @outer_mega_cannon_distance
		owner = from
		planet = star
	}
	spawn_megastructure = {
		name = "Mega Turret 12"
		type = "phanon_megaturret_intermediate_1"
		orbit_angle = 165
		orbit_distance = @outer_mega_cannon_distance
		owner = from
		planet = star
	}
	spawn_megastructure = {
		name = "Mega Turret 13"
		type = "phanon_megaturret_intermediate_1"
		orbit_angle = 180
		orbit_distance = @outer_mega_cannon_distance
		owner = from
		planet = star
	}
	spawn_megastructure = {
		name = "Mega Turret 14"
		type = "phanon_megaturret_intermediate_1"
		orbit_angle = 195
		orbit_distance = @outer_mega_cannon_distance
		owner = from
		planet = star
	}
	spawn_megastructure = {
		name = "Mega Turret 15"
		type = "phanon_megaturret_intermediate_1"
		orbit_angle = 210
		orbit_distance = @outer_mega_cannon_distance
		owner = from
		planet = star
	}
	spawn_megastructure = {
		name = "Mega Turret 16"
		type = "phanon_megaturret_intermediate_1"
		orbit_angle = 225
		orbit_distance = @outer_mega_cannon_distance
		owner = from
		planet = star
	}
	spawn_megastructure = {
		name = "Mega Turret 17"
		type = "phanon_megaturret_intermediate_1"
		orbit_angle = 240
		orbit_distance = @outer_mega_cannon_distance
		owner = from
		planet = star
	}
	spawn_megastructure = {
		name = "Mega Turret 18"
		type = "phanon_megaturret_intermediate_1"
		orbit_angle = 255
		orbit_distance = @outer_mega_cannon_distance
		owner = from
		planet = star
	}
	spawn_megastructure = {
		name = "Mega Turret 19"
		type = "phanon_megaturret_intermediate_1"
		orbit_angle = 270
		orbit_distance = @outer_mega_cannon_distance
		owner = from
		planet = star
	}
	spawn_megastructure = {
		name = "Mega Turret 20"
		type = "phanon_megaturret_intermediate_1"
		orbit_angle = 285
		orbit_distance = @outer_mega_cannon_distance
		owner = from
		planet = star
	}
	spawn_megastructure = {
		name = "Mega Turret 21"
		type = "phanon_megaturret_intermediate_1"
		orbit_angle = 300
		orbit_distance = @outer_mega_cannon_distance
		owner = from
		planet = star
	}
	spawn_megastructure = {
		name = "Mega Turret 22"
		type = "phanon_megaturret_intermediate_1"
		orbit_angle = 315
		orbit_distance = @outer_mega_cannon_distance
		owner = from
		planet = star
	}
	spawn_megastructure = {
		name = "Mega Turret 23"
		type = "phanon_megaturret_intermediate_1"
		orbit_angle = 330
		orbit_distance = @outer_mega_cannon_distance
		owner = from
		planet = star
	}
	spawn_megastructure = {
		name = "Mega Turret 24"
		type = "phanon_megaturret_intermediate_1"
		orbit_angle = 345
		orbit_distance = @outer_mega_cannon_distance
		owner = from
		planet = star
	}
}

spawn_great_wall_voidspheres = {
	system_star = {
		save_event_target_as = this_system_star
	}
	spawn_planet = {
		class = "pc_acot_enigmopolis"
		location = fromfrom
		has_ring = no
		orbit_distance_offset = @void_sphere_distance
		orbit_angle_offset = 0
		size = @void_sphere_planet_size
		init_effect = {
			set_name = "Bulwark Planet 1"
			change_pc = pc_acot_enigmopolis
			set_planet_entity = {
				entity = "pc_acot_enigmopolis_01_entity"
			}
			set_surveyed = {
				surveyed = yes
				surveyor = FROM
			}
			set_all_comms_surveyed = yes
			clear_blockers = yes
			trigger_megastructure_icon = yes
			set_planet_flag = is_void_sphere
		}
	}
	spawn_planet = {
		class = "pc_acot_enigmopolis"
		location = fromfrom
		has_ring = no
		orbit_distance_offset = @void_sphere_distance
		orbit_angle_offset = 120
		size = @void_sphere_planet_size
		init_effect = {
			set_name = "Bulwark Planet 2"
			change_pc = pc_acot_enigmopolis
			set_planet_entity = {
				entity = "pc_acot_enigmopolis_01_entity"
			}
			set_surveyed = {
				surveyed = yes
				surveyor = FROM
			}
			set_all_comms_surveyed = yes
			clear_blockers = yes
			trigger_megastructure_icon = yes
			set_planet_flag = is_void_sphere
		}
	}
	spawn_planet = {
		class = "pc_acot_enigmopolis"
		location = fromfrom
		has_ring = no
		orbit_distance_offset = @void_sphere_distance
		orbit_angle_offset = 240
		size = @void_sphere_planet_size
		init_effect = {
			set_name = "Bulwark Planet 3"
			change_pc = pc_acot_enigmopolis
			set_planet_entity = {
				entity = "pc_acot_enigmopolis_01_entity"
			}
			set_surveyed = {
				surveyed = yes
				surveyor = FROM
			}
			set_all_comms_surveyed = yes
			clear_blockers = yes
			trigger_megastructure_icon = yes
			set_planet_flag = is_void_sphere
		}
	}
}
